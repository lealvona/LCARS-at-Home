# LCARS Computer - Tool Definitions Reference
#
# This file documents all the tools (functions) available to the LLM for
# controlling the home environment. These definitions are used by the
# Extended OpenAI Conversation integration in Home Assistant.
#
# Each tool follows the OpenAI function calling specification, with a name,
# description, and JSON Schema for parameters. The LLM uses these definitions
# to understand what actions it can take and what parameters each action requires.
#
# This file is for reference only - the actual tool definitions are configured
# in the Extended OpenAI Conversation integration's "Spec" field.

tools:
  # ==========================================================================
  # LIGHTING CONTROL
  # ==========================================================================
  
  - name: control_light
    description: >
      Turn a light on, off, or adjust its brightness and color. Use this for
      any lighting command. The entity_id follows the pattern 'light.room_name'
      (e.g., light.living_room, light.kitchen, light.bedroom_ceiling).
    parameters:
      type: object
      properties:
        entity_id:
          type: string
          description: "The light entity to control (e.g., light.living_room)"
        action:
          type: string
          enum: ["on", "off", "toggle"]
          description: "The action to perform"
        brightness_pct:
          type: integer
          minimum: 0
          maximum: 100
          description: "Brightness percentage (0-100). Only used when turning on."
        color_name:
          type: string
          description: "Color name like red, blue, green, warm_white, cool_white"
      required: ["entity_id", "action"]
    examples:
      - query: "Turn on the living room lights"
        call: { entity_id: "light.living_room", action: "on" }
      - query: "Dim the bedroom to 30%"
        call: { entity_id: "light.bedroom", action: "on", brightness_pct: 30 }
      - query: "Make the kitchen light red"
        call: { entity_id: "light.kitchen", action: "on", color_name: "red" }

  - name: activate_scene
    description: >
      Activate a predefined lighting scene. Scenes set multiple lights to
      specific settings at once. Available scenes include: morning, evening,
      night, movie, reading, dinner, party, cozy, romantic, focus, calm.
    parameters:
      type: object
      properties:
        scene_name:
          type: string
          description: "Name of the scene to activate"
      required: ["scene_name"]
    examples:
      - query: "Movie time"
        call: { scene_name: "movie" }
      - query: "Make it cozy"
        call: { scene_name: "cozy" }

  # ==========================================================================
  # CLIMATE CONTROL
  # ==========================================================================

  - name: control_climate
    description: >
      Adjust the thermostat temperature or HVAC mode. Use this for any
      temperature-related commands. Can set a specific temperature or
      change the heating/cooling mode.
    parameters:
      type: object
      properties:
        entity_id:
          type: string
          description: "The climate entity (usually climate.main_thermostat)"
        temperature:
          type: number
          description: "Target temperature in degrees"
        hvac_mode:
          type: string
          enum: ["heat", "cool", "auto", "off"]
          description: "HVAC operating mode"
      required: ["entity_id"]
    examples:
      - query: "Set the temperature to 72"
        call: { entity_id: "climate.main_thermostat", temperature: 72 }
      - query: "Turn on the AC"
        call: { entity_id: "climate.main_thermostat", hvac_mode: "cool" }

  # ==========================================================================
  # SECURITY CONTROL
  # ==========================================================================

  - name: control_lock
    description: >
      Lock or unlock a door lock. This is a security-sensitive action.
      Available locks follow the pattern 'lock.door_name' (e.g., lock.front_door).
    parameters:
      type: object
      properties:
        entity_id:
          type: string
          description: "The lock entity to control (e.g., lock.front_door)"
        action:
          type: string
          enum: ["lock", "unlock"]
          description: "Lock or unlock the door"
      required: ["entity_id", "action"]
    examples:
      - query: "Lock the front door"
        call: { entity_id: "lock.front_door", action: "lock" }
      - query: "Unlock the garage door"
        call: { entity_id: "lock.garage_entry", action: "unlock" }

  # ==========================================================================
  # MEDIA CONTROL
  # ==========================================================================

  - name: control_media
    description: >
      Control media playback on speakers and TVs. Can play, pause, stop,
      or skip tracks. Also handles volume adjustment.
    parameters:
      type: object
      properties:
        entity_id:
          type: string
          description: "The media player entity"
        action:
          type: string
          enum: ["play", "pause", "stop", "next", "previous"]
          description: "Playback control action"
        volume:
          type: number
          minimum: 0
          maximum: 100
          description: "Volume level (0-100)"
      required: ["entity_id", "action"]
    examples:
      - query: "Pause the TV"
        call: { entity_id: "media_player.living_room_tv", action: "pause" }
      - query: "Next song"
        call: { entity_id: "media_player.living_room_speaker", action: "next" }

  # ==========================================================================
  # INFORMATION QUERIES
  # ==========================================================================

  - name: get_entity_state
    description: >
      Get the current state of any entity in the home. Use this to check
      if lights are on, doors are locked, what the temperature is, etc.
    parameters:
      type: object
      properties:
        entity_id:
          type: string
          description: "The entity to query"
      required: ["entity_id"]
    examples:
      - query: "Is the front door locked?"
        call: { entity_id: "lock.front_door" }
      - query: "What's the bedroom temperature?"
        call: { entity_id: "sensor.bedroom_temperature" }

  - name: get_ship_status
    description: >
      Get a comprehensive status report of all home systems including
      lighting, security, climate, and occupancy. Use this for general
      status queries or when the Commander asks for a "ship status" or
      "status report".
    parameters:
      type: object
      properties: {}
    examples:
      - query: "Ship status"
        call: {}
      - query: "Give me a status report"
        call: {}

  - name: get_weather
    description: >
      Get current weather conditions and forecast. Returns temperature,
      conditions, humidity, and forecast for the area.
    parameters:
      type: object
      properties: {}
    examples:
      - query: "What's the weather?"
        call: {}
      - query: "Will it rain today?"
        call: {}

  # ==========================================================================
  # ALERTS AND ANNOUNCEMENTS
  # ==========================================================================

  - name: red_alert
    description: >
      Activate or cancel Red Alert emergency protocol. When activated,
      lights turn red, doors lock, and notifications are sent. Use only
      for security emergencies or when explicitly requested.
    parameters:
      type: object
      properties:
        action:
          type: string
          enum: ["activate", "cancel"]
          description: "Activate or cancel Red Alert"
      required: ["action"]
    examples:
      - query: "Red Alert"
        call: { action: "activate" }
      - query: "Cancel Red Alert"
        call: { action: "cancel" }

  - name: make_announcement
    description: >
      Make a voice announcement on speakers throughout the home. The
      message will be spoken using text-to-speech.
    parameters:
      type: object
      properties:
        message:
          type: string
          description: "The message to announce"
        target:
          type: string
          description: "Where to announce: 'all' or a specific room"
      required: ["message"]
    examples:
      - query: "Announce dinner is ready"
        call: { message: "Attention all hands. Dinner is ready.", target: "all" }

  # ==========================================================================
  # TIMERS AND REMINDERS
  # ==========================================================================

  - name: set_timer
    description: >
      Set a countdown timer with voice notification when complete. The
      timer label helps identify what the timer was for when it finishes.
    parameters:
      type: object
      properties:
        minutes:
          type: integer
          description: "Timer duration in minutes"
        label:
          type: string
          description: "What the timer is for"
      required: ["minutes"]
    examples:
      - query: "Set a timer for 10 minutes for the pasta"
        call: { minutes: 10, label: "pasta" }
      - query: "Wake me up in 30 minutes"
        call: { minutes: 30, label: "nap" }

  # ==========================================================================
  # ADVANCED TASKS
  # ==========================================================================

  - name: call_n8n_workflow
    description: >
      Trigger an n8n workflow for complex tasks that require research,
      analysis, or multi-step processing. This is an asynchronous operation
      that will announce results when complete.
    parameters:
      type: object
      properties:
        workflow:
          type: string
          description: "The workflow to trigger: deep_research, analyze_data, generate_report"
        query:
          type: string
          description: "The task or query to process"
      required: ["workflow", "query"]
    examples:
      - query: "Research the current status of the Mars mission"
        call: { workflow: "deep_research", query: "current Mars mission status" }

# ==========================================================================
# CONTEXT INJECTION TEMPLATE
# ==========================================================================
#
# The following template is injected into the system prompt to provide
# the LLM with current context about the home environment. This should
# be placed in the "Additional Context" field of the integration settings.

context_template: |
  === CURRENT SHIP STATUS ===
  Ship Time: {{ now().strftime('%H%M hours on %A, %B %d, %Y') }}
  Time of Day: {{ states('sensor.time_of_day') }}
  
  === CREW STATUS ===
  Occupancy: {{ states('sensor.home_status') }}
  
  === ENVIRONMENTAL ===
  Interior Temperature: {{ states('sensor.indoor_temperature') | default('N/A') }}°
  Exterior Temperature: {{ states('sensor.outdoor_temperature') | default('N/A') }}°
  
  === SECURITY ===
  Open Entry Points: {{ states('sensor.open_entry_points') }}
  Red Alert: {{ 'ACTIVE' if is_state('input_boolean.red_alert', 'on') else 'Inactive' }}
  Away Mode: {{ 'Active' if is_state('input_boolean.away_mode', 'on') else 'Inactive' }}
  
  === LIGHTING ===
  Active Lights: {{ states('sensor.lights_on_count') }}
